<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Ultimate Starship Defender - Mikail Edition</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Courier New', monospace; color: #00ffcc; }
        canvas { display: block; }
        
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.9); display: flex; flex-direction: column;
            justify-content: flex-start; align-items: flex-start;
            padding-left: 10%; padding-top: 10vh; z-index: 100;
        }

        .btn {
            padding: 15px 30px; width: 450px; font-size: 24px; background: transparent;
            color: #00ffcc; border: 3px solid #00ffcc; cursor: pointer;
            transition: 0.3s; margin-bottom: 15px; text-transform: uppercase; font-weight: bold;
            text-align: center; font-family: 'Courier New', monospace;
        }
        .btn:hover { background: #00ffcc; color: #000; box-shadow: 0 0 20px #00ffcc; }

        /* Küçük Butonlar (Skor kutuları boyutunda) */
        .btn-sm { width: 315px; font-size: 18px; border: 2px solid #00ffcc; }

        .score-box {
            padding: 12px 25px; width: 315px; font-size: 18px; color: #fff;
            border: 2px solid rgba(0, 255, 204, 0.5); margin-bottom: 10px;
            text-align: center; background: rgba(0, 40, 40, 0.3); font-weight: bold; box-sizing: border-box;
        }

        #settingsScreen, #pauseScreen { display: none; align-items: center; padding-left: 0; justify-content: center; }
        .setting-item { margin: 10px 0; text-align: center; }
        input[type=range] { width: 300px; accent-color: #00ffcc; }

        #gameUI {
            position: absolute; top: 20px; left: 20px; background: rgba(0, 40, 40, 0.85);
            padding: 15px; border: 2px solid #00ffcc; border-radius: 8px; display: none;
        }
        #pauseBtn {
            position: absolute; top: 20px; right: 20px; padding: 10px 20px;
            background: transparent; color: #00ffcc; border: 2px solid #00ffcc;
            cursor: pointer; font-weight: bold; display: none;
        }
    </style>
</head>
<body>

    <div id="startScreen" class="screen">
        <button class="btn" onclick="startNewGame()">YENİ OYUNA BAŞLA</button>
        <div class="score-box">EN İYİ SKOR: <span id="highScoreText">0</span></div>
        <div class="score-box">EN SON SKOR: <span id="lastScoreText">0</span></div>
        <button class="btn btn-sm" onclick="toggleSettings(true)">KONTROL AYARLARI</button>
    </div>

    <div id="pauseScreen" class="screen">
        <h1 style="color:#00ffcc">OYUN DURDURULDU</h1>
        <button class="btn" onclick="resumeGame()">DEVAM ET</button>
        <button class="btn" onclick="toggleSettings(true, true)">AYARLAR</button>
        <button class="btn" onclick="goToMainMenu()">ANA MENÜ</button>
    </div>

    <div id="settingsScreen" class="screen">
        <h2 style="color:#00ffcc">KONTROL PANELİ</h2>
        <div class="setting-item"><label>EKSEN HASSASİYETİ: <span id="val_donus">0.022</span></label><br><input type="range" id="inp_donus" min="0.01" max="0.08" step="0.001" value="0.022"></div>
        <div class="setting-item"><label>GEMİ HIZI: <span id="val_hiz">1.15</span></label><br><input type="range" id="inp_hiz" min="0.5" max="3.0" step="0.1" value="1.15"></div>
        <div class="setting-item"><label>DÜŞMAN SIKLIĞI: <span id="val_siklik">3.0</span></label><br><input type="range" id="inp_siklik" min="1.0" max="6.0" step="0.5" value="3.0"></div>
        <div class="setting-item"><label>DÜŞMAN HIZI: <span id="val_dusmanHiz">0.42</span></label><br><input type="range" id="inp_dusmanHiz" min="0.1" max="1.5" step="0.05" value="0.42"></div>
        <div class="setting-item"><label>SES SEVİYESİ: <span id="val_ses">50</span>%</label><br><input type="range" id="inp_ses" min="0" max="100" step="1" value="50"></div>
        <button class="btn btn-sm" onclick="closeSettings()">KAYDET VE DÖN</button>
    </div>

    <button id="pauseBtn" onclick="togglePause()">DURDUR (ESC)</button>

    <div id="gameUI">
        <div style="color: #00ffcc; border-bottom: 1px solid #00ffcc; margin-bottom: 5px;">KAPTAN MİKAİL</div>
        <div>SKOR: <span id="skor" style="color: #fff;">0</span></div>
        <div>CAN SEVİYESİ: <span id="zirh" style="color: #0f0;">%100</span></div>
    </div>

    <canvas id="game"></canvas>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let gameActive = false, isPaused = false, skor = 0, zirh = 100;
        let settingsFromPause = false;
        const keys = {};
        let mermiler = [], dusmanlar = [], puanlar = [], saglikCantalar = [], enemyInterval;

        let settings = JSON.parse(localStorage.getItem('userSettings')) || {
            donus: 0.022, hiz: 1.15, siklik: 3.0, dusmanHiz: 0.42, ses: 0.5
        };

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(freq, type, decay) {
            if(settings.ses === 0) return;
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + decay);
            gain.gain.setValueAtTime(settings.ses, audioCtx.currentTime);
            gain.connect(audioCtx.destination);
            osc.connect(gain);
            osc.start(); osc.stop(audioCtx.currentTime + decay);
        }

        const gemi = {
            x: canvas.width / 2, y: canvas.height / 2, aci: 0,
            draw() {
                ctx.save(); ctx.translate(this.x, this.y);
                ctx.beginPath(); ctx.arc(0, 0, 22, 0, Math.PI * 2);
                ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.stroke();
                let k = Math.ceil((zirh / 100) * 15);
                ctx.save(); ctx.beginPath(); ctx.arc(0, 0, 20, 0, Math.PI * 2); ctx.clip();
                ctx.fillStyle = `hsl(${(k/15)*120}, 100%, 40%)`;
                ctx.fillRect(-22, 22 - ((k/15)*44), 44, 44); ctx.restore();
                if (gameActive) {
                    ctx.rotate(this.aci);
                    ctx.beginPath(); ctx.moveTo(34, 0); ctx.lineTo(54, 0); ctx.lineTo(44, 8); ctx.lineTo(44, -8); ctx.lineTo(54, 0);
                    ctx.fillStyle = '#00ffcc'; ctx.fill();
                }
                ctx.restore();
            }
        };

        function spawnEnemy() {
            if(!gameActive || isPaused) return;
            const side = Math.floor(Math.random() * 4); // 0:üst, 1:sağ, 2:alt, 3:sol
            let x, y;
            if(side === 0) { x = Math.random()*canvas.width; y = -50; }
            else if(side === 1) { x = canvas.width+50; y = Math.random()*canvas.height; }
            else if(side === 2) { x = Math.random()*canvas.width; y = canvas.height+50; }
            else { x = -50; y = Math.random()*canvas.height; }
            dusmanlar.push({x, y});
        }

        function update() {
            if (!gameActive || isPaused) return;
            let zorluk = 1 + (skor / 20000);
            if (keys['KeyA']) gemi.aci -= settings.donus;
            if (keys['KeyD']) gemi.aci += settings.donus;
            let v = 0;
            if (keys['KeyW']) v = keys['ShiftLeft'] ? settings.hiz * 1.8 * zorluk : settings.hiz * zorluk;
            else if (keys['KeyS']) v = -settings.hiz * 0.8;
            gemi.x += Math.cos(gemi.aci) * v; gemi.y += Math.sin(gemi.aci) * v;
            gemi.x = Math.max(30, Math.min(canvas.width - 30, gemi.x));
            gemi.y = Math.max(30, Math.min(canvas.height - 30, gemi.y));

            if (keys['Space'] && !gemi.fireLock) {
                playSound(150, 'triangle', 0.1); // Ateş sesi
                mermiler.push({x: gemi.x, y: gemi.y, vx: Math.cos(gemi.aci)*10, vy: Math.sin(gemi.aci)*10});
                gemi.fireLock = true; setTimeout(() => gemi.fireLock = false, 250);
            }

            dusmanlar.forEach((d, i) => {
                let dist = Math.hypot(gemi.x - d.x, gemi.y - d.y);
                d.x += (gemi.x - d.x)/dist * (settings.dusmanHiz * zorluk);
                d.y += (gemi.y - d.y)/dist * (settings.dusmanHiz * zorluk);
                if(dist < 35) { zirh -= 0.15; if(zirh <= 0) gameOver(); }
                mermiler.forEach((m, mi) => {
                    if(Math.hypot(m.x - d.x, m.y - d.y) < 25) {
                        playSound(1200, 'sine', 0.05); // Çın sesi
                        puanlar.push({x: d.x, y: d.y});
                        dusmanlar.splice(i, 1); mermiler.splice(mi, 1); skor += 10;
                    }
                });
            });

            puanlar.forEach((p, i) => {
                let d = Math.hypot(gemi.x - p.x, gemi.y - p.y);
                if(d < 150) { p.x += (gemi.x-p.x)/d*4; p.y += (gemi.y-p.y)/d*4; }
                if(d < 30) { skor += 100; puanlar.splice(i, 1); }
            });

            saglikCantalar.forEach((s, i) => {
                if(Math.hypot(gemi.x - s.x, gemi.y - s.y) < 40) {
                    zirh = Math.min(100, zirh + 30); // %80 sınırı kaldırıldı
                    saglikCantalar.splice(i, 1);
                }
            });

            mermiler.forEach((m, i) => { m.x += m.vx; m.y += m.vy; if(m.x<0||m.x>canvas.width||m.y<0||m.y>canvas.height) mermiler.splice(i, 1); });
            document.getElementById('skor').innerText = skor;
            document.getElementById('zirh').innerText = `%${Math.floor(zirh)}`;
        }

        function draw() {
            ctx.fillStyle = 'rgba(0,0,0,0.3)'; ctx.fillRect(0,0,canvas.width,canvas.height);
            if(gameActive) {
                gemi.draw();
                mermiler.forEach(m => { ctx.fillStyle='#ff0'; ctx.beginPath(); ctx.arc(m.x,m.y,4,0,Math.PI*2); ctx.fill(); });
                dusmanlar.forEach(d => { ctx.strokeStyle='#f44'; ctx.beginPath(); ctx.arc(d.x,d.y,20,0,Math.PI*2); ctx.stroke(); });
                puanlar.forEach(p => { ctx.fillStyle='#0f0'; ctx.beginPath(); ctx.arc(p.x,p.y,4,0,Math.PI*2); ctx.fill(); });
                saglikCantalar.forEach(s => { ctx.fillStyle='#fff'; ctx.fillRect(s.x-10,s.y-10,20,20); ctx.fillStyle='#f00'; ctx.fillRect(s.x-8,s.y-2,16,4); ctx.fillRect(s.x-2,s.y-8,4,16); });
            } else {
                ctx.save(); ctx.translate(canvas.width*0.8, canvas.height*0.3); gemi.draw(); ctx.restore();
            }
        }

        function togglePause() {
            if(!gameActive) return;
            isPaused = !isPaused;
            document.getElementById('pauseScreen').style.display = isPaused ? 'flex' : 'none';
        }

        function resumeGame() { isPaused = false; document.getElementById('pauseScreen').style.display = 'none'; }
        function goToMainMenu() { location.reload(); }

        function startNewGame() {
            gameActive = true; isPaused = false; skor = 0; zirh = 100;
            dusmanlar = []; mermiler = []; puanlar = []; saglikCantalar = [];
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameUI').style.display = 'block';
            document.getElementById('pauseBtn').style.display = 'block';
            if(enemyInterval) clearInterval(enemyInterval);
            enemyInterval = setInterval(() => {
                if(gameActive && !isPaused) {
                    spawnEnemy();
                    if(zirh < 70 && saglikCantalar.length < 2) saglikCantalar.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height});
                }
            }, settings.siklik * 1000);
        }

        function toggleSettings(show, fromPause = false) {
            settingsFromPause = fromPause;
            document.getElementById(fromPause ? 'pauseScreen' : 'startScreen').style.display = show ? 'none' : 'flex';
            document.getElementById('settingsScreen').style.display = show ? 'flex' : 'none';
        }
        function closeSettings() { toggleSettings(false, settingsFromPause); updateScoreDisplay(); }

        function gameOver() {
            gameActive = false; clearInterval(enemyInterval);
            if(skor > (localStorage.getItem('highScore')||0)) localStorage.setItem('highScore', skor);
            localStorage.setItem('lastScore', skor);
            goToMainMenu();
        }

        function updateSettingsUI() {
            ['donus', 'hiz', 'siklik', 'dusmanHiz', 'ses'].forEach(id => {
                let inp = document.getElementById('inp_'+id);
                let valDisp = document.getElementById('val_'+id);
                inp.value = id === 'ses' ? settings[id]*100 : settings[id];
                valDisp.innerText = id === 'ses' ? Math.round(settings[id]*100) : settings[id];
                inp.oninput = (e) => {
                    let v = parseFloat(e.target.value);
                    settings[id] = id === 'ses' ? v/100 : v;
                    valDisp.innerText = v;
                    localStorage.setItem('userSettings', JSON.stringify(settings));
                };
            });
        }

        function updateScoreDisplay() {
            document.getElementById('highScoreText').innerText = localStorage.getItem('highScore') || 0;
            document.getElementById('lastScoreText').innerText = localStorage.getItem('lastScore') || 0;
        }

        window.addEventListener('keydown', e => {
            keys[e.code] = true;
            if(e.code === 'Escape') togglePause();
        });
        window.addEventListener('keyup', e => keys[e.code] = false);
        function loop() { update(); draw(); requestAnimationFrame(loop); }
        updateSettingsUI(); updateScoreDisplay(); loop();
    </script>
</body>
</html>

 
