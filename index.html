<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Ultimate Starship Defender - Magnet & Shift Edition</title>
    <style>
        body { margin: 0; background: #050505; overflow: hidden; font-family: 'Courier New', monospace; color: #00ffcc; }
        canvas { display: block; }
        #ui { position: absolute; top: 20px; left: 20px; background: rgba(0, 40, 40, 0.8); padding: 15px; border: 2px solid #00ffcc; border-radius: 5px; pointer-events: none; }
        .controls { font-size: 12px; color: #fff; margin-top: 10px; border-top: 1px solid #00ffcc; padding-top: 5px; }
    </style>
</head>
<body>

<div id="ui">
    <div style="font-size: 18px; font-weight: bold;">KAPTAN MİKAİL - COMMAND CENTER</div>
    <div>Skor: <span id="skor">0</span></div>
    <div>Zırh: %<span id="zirh">100</span></div>
    <div>Lazer Şarj: %<span id="lazerSarj">0</span></div>
    <div class="controls">
        W: İleri Git | S: Geri Git | A-D: Dönüş<br>
        SHIFT: Hızlı Git | BOŞLUK: Ateş | F: Lazer
    </div>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let skor = 0;
let zirh = 100;
let lazerSarj = 0;
const keys = {};
let mermiler = [];
let dusmanlar = [];
let puanlar = []; // Takip eden puanlar

window.addEventListener('keydown', e => keys[e.code] = true);
window.addEventListener('keyup', e => keys[e.code] = false);

const gemi = {
    x: canvas.width / 2,
    y: canvas.height / 2,
    aci: 0,
    normalHiz: 4,
    turboHiz: 8,
    donusHizi: 0.08,
    
    draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.aci);
        
        // Gemi Tasarımı
        ctx.beginPath();
        ctx.moveTo(20, 0); ctx.lineTo(-15, 15); ctx.lineTo(-10, 0); ctx.lineTo(-15, -15);
        ctx.closePath();
        ctx.fillStyle = '#00ffcc';
        ctx.fill();
        ctx.strokeStyle = '#fff';
        ctx.stroke();

        // Motor ateşi efekti
        if (keys['KeyW']) {
            ctx.beginPath();
            ctx.moveTo(-12, 0);
            ctx.lineTo(-25, 0);
            ctx.strokeStyle = keys['ShiftLeft'] ? '#00ffff' : '#ffaa00';
            ctx.lineWidth = keys['ShiftLeft'] ? 4 : 2;
            ctx.stroke();
        }
        ctx.restore();
    },

    update() {
        // Dönüş
        if (keys['KeyA']) this.aci -= this.donusHizi;
        if (keys['KeyD']) this.aci += this.donusHizi;
        
        // Hareket Mantığı (W'ya basınca gider, basmayınca durur)
        let mevcutHiz = 0;
        if (keys['KeyW']) {
            mevcutHiz = keys['ShiftLeft'] || keys['ShiftRight'] ? this.turboHiz : this.normalHiz;
        } else if (keys['KeyS']) {
            mevcutHiz = -this.normalHiz;
        }

        this.x += Math.cos(this.aci) * mevcutHiz;
        this.y += Math.sin(this.aci) * mevcutHiz;

        // Ekran Sınırları
        const p = 25;
        if (this.x < p) this.x = p;
        if (this.x > canvas.width - p) this.x = canvas.width - p;
        if (this.y < p) this.y = p;
        if (this.y > canvas.height - p) this.y = canvas.height - p;

        // Ateş etme
        if (keys['Space'] && !this.ateslendi) {
            this.fire('normal');
            this.ateslendi = true;
            setTimeout(() => this.ateslendi = false, 200);
        }
        if (keys['KeyF'] && lazerSarj >= 100) { this.fire('lazer'); lazerSarj = 0; }
        if (lazerSarj < 100) lazerSarj += 0.15;
        document.getElementById('lazerSarj').innerText = Math.floor(lazerSarj);
    },

    fire(type) {
        mermiler.push({
            x: this.x + Math.cos(this.aci) * 20,
            y: this.y + Math.sin(this.aci) * 20,
            vx: Math.cos(this.aci) * (type === 'lazer' ? 22 : 14),
            vy: Math.sin(this.aci) * (type === 'lazer' ? 22 : 14),
            type: type
        });
    }
};

function spawnEnemy() {
    if(dusmanlar.length < 15) {
        dusmanlar.push({
            x: Math.random() > 0.5 ? -50 : canvas.width + 50,
            y: Math.random() * canvas.height,
            size: 25, hiz: 1.5 + (skor/10000)
        });
    }
}

function update() {
    gemi.update();

    mermiler.forEach((m, mi) => {
        m.x += m.vx; m.y += m.vy;
        if(m.x < 0 || m.x > canvas.width || m.y < 0 || m.y > canvas.height) mermiler.splice(mi, 1);
    });

    dusmanlar.forEach((d, di) => {
        const dx = gemi.x - d.x;
        const dy = gemi.y - d.y;
        const dist = Math.hypot(dx, dy);
        d.x += (dx / dist) * d.hiz;
        d.y += (dy / dist) * d.hiz;

        if(dist < d.size + 15) {
            zirh -= 0.2;
            document.getElementById('zirh').innerText = Math.floor(zirh);
            if(zirh <= 0) location.reload();
        }

        mermiler.forEach((m, mi) => {
            if(Math.hypot(m.x - d.x, m.y - d.y) < d.size) {
                // Düşman ölünce puan topu bırakır
                puanlar.push({ x: d.x, y: d.y, size: 6 });
                dusmanlar.splice(di, 1);
                if(m.type !== 'lazer') mermiler.splice(mi, 1);
            }
        });
    });

    // MIKNATISLI PUAN SİSTEMİ
    puanlar.forEach((p, pi) => {
        const dx = gemi.x - p.x;
        const dy = gemi.y - p.y;
        const dist = Math.hypot(dx, dy);

        // Belirli bir mesafeye gelince çekilmeye başlar
        if(dist < 300) {
            p.x += (dx / dist) * 8;
            p.y += (dy / dist) * 8;
        }

        // Puan toplama
        if(dist < 30) {
            skor += 100;
            document.getElementById('skor').innerText = skor;
            puanlar.splice(pi, 1);
        }
    });
}

function draw() {
    ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    gemi.draw();
    
    mermiler.forEach(m => {
        ctx.fillStyle = m.type === 'lazer' ? '#0ff' : '#ff0';
        ctx.beginPath(); ctx.arc(m.x, m.y, m.type === 'lazer' ? 6 : 3, 0, Math.PI*2); ctx.fill();
    });

    dusmanlar.forEach(d => {
        ctx.strokeStyle = '#ff4444';
        ctx.lineWidth = 2;
        ctx.beginPath(); ctx.arc(d.x, d.y, d.size, 0, Math.PI*2); ctx.stroke();
    });

    // Puanların çizimi (Yeşil parlayan toplar)
    puanlar.forEach(p => {
        ctx.fillStyle = '#0f0';
        ctx.shadowBlur = 15;
        ctx.shadowColor = '#0f0';
        ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
        ctx.shadowBlur = 0;
    });
}

function loop() { update(); draw(); requestAnimationFrame(loop); }
setInterval(spawnEnemy, 1200);
loop();

window.onresize = () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
};
</script>
</body>
</html>
